<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ISL Translator â€” Indian Sign Language</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- MediaPipe Hands (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

<style>
/* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #0a0c14;
  --surface:   #111520;
  --surface2:  #181d2e;
  --border:    rgba(99,102,241,.18);
  --accent:    #6366f1;
  --accent2:   #8b5cf6;
  --green:     #22c55e;
  --yellow:    #eab308;
  --red:       #ef4444;
  --text:      #f1f5f9;
  --muted:     #64748b;
  --glow:      0 0 32px rgba(99,102,241,.35);
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ Animated gradient background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: -1;
  background:
    radial-gradient(ellipse 80% 50% at 20% 10%, rgba(99,102,241,.12), transparent),
    radial-gradient(ellipse 60% 40% at 80% 80%, rgba(139,92,246,.10), transparent);
  animation: bgPulse 8s ease-in-out infinite alternate;
}
@keyframes bgPulse {
  from { opacity: .7; }
  to   { opacity: 1; }
}

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app {
  display: grid;
  grid-template-rows: auto 1fr auto;
  min-height: 100vh;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 32px;
}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 28px 0 24px;
  border-bottom: 1px solid var(--border);
}

.logo-icon {
  width: 48px; height: 48px;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  display: grid; place-items: center;
  font-size: 22px;
  box-shadow: var(--glow);
  flex-shrink: 0;
}

.logo-text h1 {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -.3px;
}
.logo-text p {
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

.status-pill {
  margin-left: auto;
  display: flex; align-items: center; gap: 8px;
  padding: 6px 14px;
  border-radius: 999px;
  background: rgba(34,197,94,.1);
  border: 1px solid rgba(34,197,94,.25);
  font-size: 12px;
  font-weight: 500;
  color: var(--green);
  transition: all .3s;
}
.status-pill.inactive {
  background: rgba(239,68,68,.1);
  border-color: rgba(239,68,68,.25);
  color: var(--red);
}
.status-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: currentColor;
  animation: blink 1.2s ease-in-out infinite;
}
@keyframes blink {
  0%,100% { opacity: 1; }
  50%      { opacity: .3; }
}

/* â”€â”€ Main grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 24px;
  padding: 28px 0;
}
@media (max-width: 860px) {
  .main { grid-template-columns: 1fr; }
}

/* â”€â”€ Camera panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.camera-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.video-wrapper {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  border: 1px solid var(--border);
  background: #000;
  aspect-ratio: 4/3;
  box-shadow: 0 24px 48px rgba(0,0,0,.5);
}

#video {
  width: 100%; height: 100%;
  object-fit: cover;
  display: block;
  transform: scaleX(-1); /* mirror */
}
#canvas-overlay {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  transform: scaleX(-1);
  pointer-events: none;
}

/* Hand detection box */
.hand-box {
  position: absolute;
  border: 2px solid var(--green);
  border-radius: 10px;
  box-shadow: 0 0 16px rgba(34,197,94,.35);
  pointer-events: none;
  transition: all .1s;
  display: none;
}

/* Corner brackets on video */
.video-wrapper::before, .video-wrapper::after {
  content: ''; position: absolute; z-index: 3;
  width: 24px; height: 24px;
  border-color: var(--accent);
  border-style: solid;
  opacity: .7;
}
.video-wrapper::before { top: 12px; left: 12px; border-width: 2px 0 0 2px; border-radius: 4px 0 0 0; }
.video-wrapper::after  { bottom: 12px; right: 12px; border-width: 0 2px 2px 0; border-radius: 0 0 4px 0; }

/* Camera start overlay */
.camera-overlay {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 16px;
  background: rgba(10,12,20,.9);
  z-index: 10;
  cursor: pointer;
  transition: opacity .4s;
}
.camera-overlay .cam-icon {
  width: 64px; height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  display: grid; place-items: center;
  font-size: 28px;
  box-shadow: var(--glow);
  animation: float 3s ease-in-out infinite;
}
@keyframes float {
  0%,100% { transform: translateY(0); }
  50%      { transform: translateY(-8px); }
}
.camera-overlay h2 { font-size: 18px; font-weight: 600; }
.camera-overlay p  { font-size: 13px; color: var(--muted); text-align: center; max-width: 260px; }
.start-btn {
  padding: 11px 28px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  font-size: 14px; font-weight: 600;
  box-shadow: var(--glow);
  transition: transform .15s, box-shadow .15s;
}
.start-btn:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(99,102,241,.5); }

/* Current prediction banner */
.pred-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  border-radius: 14px;
  background: var(--surface);
  border: 1px solid var(--border);
}
.pred-label {
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
}
.pred-value {
  font-size: 48px;
  font-weight: 800;
  line-height: 1;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  min-width: 60px;
  text-align: center;
  transition: all .2s;
}
.pred-conf {
  display: flex; flex-direction: column; align-items: flex-end; gap: 4px;
}
.conf-pct {
  font-size: 18px; font-weight: 700;
}
.conf-bar-wrap {
  width: 80px; height: 6px;
  background: var(--surface2);
  border-radius: 999px;
  overflow: hidden;
}
.conf-bar {
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  transition: width .3s ease;
}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 18px 20px;
}
.card-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--muted);
  margin-bottom: 14px;
}

/* Top 3 alternatives */
.alt-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255,255,255,.04);
}
.alt-row:last-child { border-bottom: none; }
.alt-badge {
  width: 34px; height: 34px;
  border-radius: 8px;
  display: grid; place-items: center;
  font-size: 16px; font-weight: 700;
  background: var(--surface2);
  flex-shrink: 0;
}
.alt-badge.rank-1 { background: rgba(99,102,241,.2); color: var(--accent); }
.alt-badge.rank-2 { background: rgba(139,92,246,.12); color: var(--accent2); }
.alt-badge.rank-3 { background: rgba(100,116,139,.1); color: var(--muted); }
.alt-info { flex: 1; min-width: 0; }
.alt-name { font-size: 13px; font-weight: 600; }
.alt-bar-wrap { height: 4px; background: var(--surface2); border-radius: 999px; overflow: hidden; margin-top: 5px; }
.alt-bar { height: 100%; border-radius: 999px; transition: width .35s ease; }
.alt-pct { font-size: 12px; color: var(--muted); font-weight: 500; flex-shrink: 0; }

/* Hold timer ring */
.timer-card {
  display: flex;
  align-items: center;
  gap: 16px;
}
.timer-ring-wrap {
  position: relative; width: 60px; height: 60px; flex-shrink: 0;
}
.timer-ring-wrap svg { transform: rotate(-90deg); }
.ring-bg    { fill: none; stroke: var(--surface2); stroke-width: 4; }
.ring-prog  { fill: none; stroke: url(#ringGrad); stroke-width: 4; stroke-linecap: round;
              stroke-dasharray: 163; stroke-dashoffset: 163; transition: stroke-dashoffset .1s linear; }
.ring-text  { position: absolute; inset: 0; display: grid; place-items: center;
              font-size: 13px; font-weight: 700; }
.timer-info p { font-size: 13px; color: var(--muted); margin-top: 4px; }
.timer-info strong { font-size: 14px; }

/* Sentence area */
.sentence-box {
  min-height: 80px;
  padding: 14px 16px;
  border-radius: 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
  font-size: 22px;
  font-weight: 600;
  line-height: 1.5;
  word-break: break-all;
  color: var(--text);
  position: relative;
  transition: all .2s;
}
.cursor-blink {
  display: inline-block;
  width: 2px; height: 1.1em;
  background: var(--accent);
  margin-left: 3px;
  vertical-align: middle;
  animation: cursor 1.1s step-start infinite;
}
@keyframes cursor { 0%,100% { opacity: 1; } 50% { opacity: 0; } }

.sentence-placeholder {
  color: var(--muted);
  font-size: 14px;
  font-weight: 400;
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  white-space: nowrap;
}

/* Controls */
.controls { display: flex; gap: 8px; flex-wrap: wrap; }
.ctrl-btn {
  flex: 1;
  padding: 9px 0;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface2);
  color: var(--text);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .15s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.ctrl-btn:hover { background: rgba(99,102,241,.15); border-color: var(--accent); color: var(--accent); }
.ctrl-btn.danger:hover { background: rgba(239,68,68,.12); border-color: var(--red); color: var(--red); }

/* Tips */
.tips li { font-size: 12px; color: var(--muted); margin-left: 16px; margin-bottom: 6px; line-height: 1.5; }
.tips li::marker { color: var(--accent); }

/* â”€â”€ Output section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.output-section {
  padding: 24px 0 0;
  border-top: 1px solid var(--border);
}
.output-heading {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--muted);
  margin-bottom: 12px;
}
.output-text {
  font-size: 28px;
  font-weight: 700;
  min-height: 44px;
  line-height: 1.4;
  word-break: break-all;
}

/* Toast */
#toast {
  position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(80px);
  padding: 10px 22px; border-radius: 999px;
  background: var(--surface);
  border: 1px solid var(--border);
  font-size: 13px; font-weight: 500;
  backdrop-filter: blur(12px);
  transition: transform .3s ease;
  z-index: 100;
  white-space: nowrap;
}
#toast.show { transform: translateX(-50%) translateY(0); }

/* Pulsing hand glow when detected */
@keyframes handGlow {
  0%,100% { box-shadow: 0 0 0 0 rgba(34,197,94,.4); }
  50%      { box-shadow: 0 0 0 8px rgba(34,197,94,0); }
}
.video-wrapper.detecting { animation: handGlow 1.5s ease-in-out infinite; }
</style>
</head>
<body>

<div class="app">

  <!-- HEADER -->
  <header>
    <div class="logo-icon">ğŸ¤Ÿ</div>
    <div class="logo-text">
      <h1>ISL Translator</h1>
      <p>Indian Sign Language â€” Real-time Detection</p>
    </div>
    <div class="status-pill inactive" id="statusPill">
      <span class="status-dot"></span>
      <span id="statusText">Camera Off</span>
    </div>
  </header>

  <!-- MAIN -->
  <div class="main">

    <!-- LEFT: Camera -->
    <div class="camera-panel">
      <div class="video-wrapper" id="videoWrapper">
        <!-- Start overlay -->
        <div class="camera-overlay" id="cameraOverlay">
          <div class="cam-icon">ğŸ“·</div>
          <h2>Start Camera</h2>
          <p>Allow camera access to begin real-time sign language detection</p>
          <button class="start-btn" onclick="startCamera()">Enable Camera</button>
        </div>

        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas-overlay"></canvas>
      </div>

      <!-- Prediction banner -->
      <div class="pred-banner">
        <div>
          <div class="pred-label">Current Sign</div>
          <div class="pred-value" id="predValue">â€”</div>
        </div>
        <div class="pred-conf">
          <div class="conf-pct" id="confPct">0%</div>
          <div class="conf-bar-wrap">
            <div class="conf-bar" id="confBar" style="width:0%"></div>
          </div>
        </div>
      </div>

      <!-- Output text -->
      <div class="output-section">
        <div class="output-heading">ğŸ“ Translated Output</div>
        <div class="output-text" id="outputText">
          <span style="color:var(--muted);font-size:16px;font-weight:400">
            Your signs will appear hereâ€¦
          </span>
        </div>
      </div>
    </div>

    <!-- RIGHT: Sidebar -->
    <div class="sidebar">

      <!-- Sentence builder -->
      <div class="card">
        <div class="card-title">âœï¸ Sentence Builder</div>
        <div class="sentence-box" id="sentenceBox">
          <span class="sentence-placeholder" id="sentPlaceholder">Start signingâ€¦</span>
          <span id="sentenceText"></span>
          <span class="cursor-blink" id="cursor" style="display:none"></span>
        </div>
        <div class="controls" style="margin-top:10px">
          <button class="ctrl-btn" onclick="addSpace()">â£ Space</button>
          <button class="ctrl-btn" onclick="deleteLast()">âŒ« Delete</button>
          <button class="ctrl-btn danger" onclick="clearAll()">ğŸ—‘ Clear</button>
        </div>
      </div>

      <!-- Hold timer -->
      <div class="card">
        <div class="card-title">â± Hold Timer</div>
        <div class="timer-card">
          <div class="timer-ring-wrap">
            <svg width="60" height="60" viewBox="0 0 60 60">
              <defs>
                <linearGradient id="ringGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#6366f1"/>
                  <stop offset="100%" stop-color="#8b5cf6"/>
                </linearGradient>
              </defs>
              <circle class="ring-bg"   cx="30" cy="30" r="26"/>
              <circle class="ring-prog" cx="30" cy="30" r="26" id="timerRing"/>
            </svg>
            <div class="ring-text" id="timerText">0s</div>
          </div>
          <div class="timer-info">
            <strong>Hold for 1.5 s to lock</strong>
            <p>Keep your hand steady until the ring completes</p>
          </div>
        </div>
      </div>

      <!-- Top-3 alternatives -->
      <div class="card">
        <div class="card-title">ğŸ“Š Top Predictions</div>
        <div id="altList">
          <div class="alt-row" id="alt-0">
            <div class="alt-badge rank-1">â€”</div>
            <div class="alt-info">
              <div class="alt-name">â€”</div>
              <div class="alt-bar-wrap"><div class="alt-bar" style="width:0%;background:var(--accent)"></div></div>
            </div>
            <span class="alt-pct">â€”</span>
          </div>
          <div class="alt-row" id="alt-1">
            <div class="alt-badge rank-2">â€”</div>
            <div class="alt-info">
              <div class="alt-name">â€”</div>
              <div class="alt-bar-wrap"><div class="alt-bar" style="width:0%;background:var(--accent2)"></div></div>
            </div>
            <span class="alt-pct">â€”</span>
          </div>
          <div class="alt-row" id="alt-2">
            <div class="alt-badge rank-3">â€”</div>
            <div class="alt-info">
              <div class="alt-name">â€”</div>
              <div class="alt-bar-wrap"><div class="alt-bar" style="width:0%;background:var(--muted)"></div></div>
            </div>
            <span class="alt-pct">â€”</span>
          </div>
        </div>
      </div>

      <!-- Tips -->
      <div class="card">
        <div class="card-title">ğŸ’¡ Tips</div>
        <ul class="tips">
          <li>Face your camera in good lighting</li>
          <li>Keep hand inside the frame</li>
          <li>Hold the sign steady for 1.5 seconds</li>
          <li>Use <strong>Space</strong> to separate words</li>
          <li>Supported: Aâ€“Z and 1â€“9 signs</li>
        </ul>
      </div>

    </div>
  </div><!-- .main -->

</div><!-- .app -->

<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>

/* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let sentence       = '';
let lastAddedChar  = '';
let holdStart      = null;
let holdLabel      = '';
let isCapturing    = false;
let handPresent    = false;
let animFrame      = null;
const HOLD_MS      = 1500;   // ms to hold before locking a character
const CAPTURE_INTERVAL_MS = 400; // how often we send a frame to server
let lastCapture    = 0;

const CIRCUMFERENCE = 2 * Math.PI * 26;   // ring radius = 26

/* â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const video         = document.getElementById('video');
const canvasOv      = document.getElementById('canvas-overlay');
const ctx           = canvasOv.getContext('2d');
const predValue     = document.getElementById('predValue');
const confPct       = document.getElementById('confPct');
const confBar       = document.getElementById('confBar');
const sentenceText  = document.getElementById('sentenceText');
const sentPlaceholder = document.getElementById('sentPlaceholder');
const cursor        = document.getElementById('cursor');
const outputText    = document.getElementById('outputText');
const statusPill    = document.getElementById('statusPill');
const statusText    = document.getElementById('statusText');
const timerRing     = document.getElementById('timerRing');
const timerText     = document.getElementById('timerText');
const videoWrapper  = document.getElementById('videoWrapper');

/* â”€â”€ MediaPipe Hands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const handsMP = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
handsMP.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.65,
  minTrackingConfidence: 0.55,
});
handsMP.onResults(onHandResults);

/* â”€â”€ Start camera â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: 640, height: 480 } });
    video.srcObject = stream;
    await video.play();

    document.getElementById('cameraOverlay').style.display = 'none';
    setStatus(true);

    // Resize overlay canvas to match video
    video.addEventListener('loadedmetadata', resizeCanvas);
    resizeCanvas();

    // Start MediaPipe camera feed
    const cam = new Camera(video, {
      onFrame: async () => { await handsMP.send({ image: video }); },
      width: 640, height: 480
    });
    cam.start();

    cursor.style.display = 'inline-block';
    isCapturing = true;

    showToast('Camera started â€” show a sign!');
  } catch (err) {
    showToast('âš  Camera access denied. Please allow camera.');
    console.error(err);
  }
}

function resizeCanvas() {
  canvasOv.width  = video.videoWidth  || 640;
  canvasOv.height = video.videoHeight || 480;
}

/* â”€â”€ Hand detection callback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onHandResults(results) {
  ctx.clearRect(0, 0, canvasOv.width, canvasOv.height);

  if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
    handPresent = false;
    holdStart   = null;
    updateTimer(0);
    videoWrapper.classList.remove('detecting');
    return;
  }

  handPresent = true;
  videoWrapper.classList.add('detecting');

  const landmarks = results.multiHandLandmarks[0];

  // Compute bounding box from landmarks
  const xs = landmarks.map(l => l.x * canvasOv.width);
  const ys = landmarks.map(l => l.y * canvasOv.height);
  const pad = 30;
  const x1  = Math.max(0, Math.min(...xs) - pad);
  const y1  = Math.max(0, Math.min(...ys) - pad);
  const x2  = Math.min(canvasOv.width,  Math.max(...xs) + pad);
  const y2  = Math.min(canvasOv.height, Math.max(...ys) + pad);

  // Draw hand bounding box
  ctx.strokeStyle = '#22c55e';
  ctx.lineWidth   = 2;
  ctx.shadowColor = '#22c55e';
  ctx.shadowBlur  = 10;
  roundRect(ctx, x1, y1, x2 - x1, y2 - y1, 8);
  ctx.stroke();
  ctx.shadowBlur  = 0;

  // Draw landmarks
  drawLandmarks(landmarks);

  // Capture hand crop and send to server throttled
  const now = Date.now();
  if (now - lastCapture > CAPTURE_INTERVAL_MS) {
    lastCapture = now;
    captureAndPredict(x1, y1, x2 - x1, y2 - y1);
  }
}

function drawLandmarks(landmarks) {
  const CONNECTIONS = [
    [0,1],[1,2],[2,3],[3,4],
    [0,5],[5,6],[6,7],[7,8],
    [0,9],[9,10],[10,11],[11,12],
    [0,13],[13,14],[14,15],[15,16],
    [0,17],[17,18],[18,19],[19,20],
    [5,9],[9,13],[13,17]
  ];

  ctx.strokeStyle = 'rgba(99,102,241,0.6)';
  ctx.lineWidth   = 1.5;
  CONNECTIONS.forEach(([a, b]) => {
    ctx.beginPath();
    ctx.moveTo(landmarks[a].x * canvasOv.width, landmarks[a].y * canvasOv.height);
    ctx.lineTo(landmarks[b].x * canvasOv.width, landmarks[b].y * canvasOv.height);
    ctx.stroke();
  });

  landmarks.forEach(l => {
    ctx.beginPath();
    ctx.arc(l.x * canvasOv.width, l.y * canvasOv.height, 3, 0, 2 * Math.PI);
    ctx.fillStyle = '#6366f1';
    ctx.fill();
  });
}

/* â”€â”€ Capture crop â†’ send to Flask â†’ handle result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const captureCanvas = document.createElement('canvas');
const captureCtx    = captureCanvas.getContext('2d');

async function captureAndPredict(x, y, w, h) {
  if (!handPresent || w < 10 || h < 10) return;

  // Draw mirrored crop
  captureCanvas.width  = w;
  captureCanvas.height = h;
  // video is CSS-mirrored but actual pixel data is not â€” draw normally
  captureCtx.drawImage(video, x, y, w, h, 0, 0, w, h);

  const b64 = captureCanvas.toDataURL('image/jpeg', 0.85);

  try {
    const res  = await fetch('/predict', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body:    JSON.stringify({ image: b64 })
    });
    const data = await res.json();
    if (data.error) return;

    displayPrediction(data.label, data.confidence, data.top3);
    handleHoldTimer(data.label, data.confidence);
  } catch (e) {
    console.warn('Predict error:', e);
  }
}

/* â”€â”€ Display prediction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function displayPrediction(label, conf, top3) {
  predValue.textContent = label;

  const pct = Math.round(conf * 100);
  confPct.textContent = pct + '%';
  confBar.style.width = pct + '%';

  // Colour confidence bar
  confBar.style.background =
    conf >= .80 ? 'linear-gradient(90deg,#22c55e,#16a34a)' :
    conf >= .55 ? 'linear-gradient(90deg,#eab308,#ca8a04)' :
                  'linear-gradient(90deg,#ef4444,#dc2626)';

  // Update top-3
  const colours = ['var(--accent)', 'var(--accent2)', 'var(--muted)'];
  (top3 || []).slice(0, 3).forEach((t, i) => {
    const row   = document.getElementById('alt-' + i);
    if (!row) return;
    row.querySelector('.alt-badge').textContent = t.label;
    row.querySelector('.alt-name').textContent  = t.label === label ? `${t.label} âœ“` : t.label;
    row.querySelector('.alt-bar').style.width   = Math.round(t.conf * 100) + '%';
    row.querySelector('.alt-pct').textContent   = Math.round(t.conf * 100) + '%';
  });
}

/* â”€â”€ Hold timer (lock character after HOLD_MS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function handleHoldTimer(label, conf) {
  if (conf < 0.5) { holdStart = null; holdLabel = ''; updateTimer(0); return; }

  if (label !== holdLabel) {
    holdLabel = label;
    holdStart = Date.now();
  }

  const elapsed  = Date.now() - holdStart;
  const progress = Math.min(elapsed / HOLD_MS, 1.0);
  updateTimer(progress);

  if (progress >= 1.0 && label !== lastAddedChar) {
    // Lock character
    sentence      += label;
    lastAddedChar  = label;
    updateSentence();
    holdStart      = Date.now(); // reset so same letter can be added again after another hold
    showToast(`Added: "${label}"`);
  }
}

function updateTimer(progress) {
  const offset = CIRCUMFERENCE * (1 - progress);
  timerRing.style.strokeDashoffset = offset;
  timerText.textContent = progress > 0 ? (progress * HOLD_MS / 1000).toFixed(1) + 's' : '0s';
}

/* â”€â”€ Sentence helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateSentence() {
  sentenceText.textContent = sentence;
  sentPlaceholder.style.display = sentence ? 'none' : '';
  outputText.innerHTML = sentence
    ? `<span>${sentence}</span>`
    : '<span style="color:var(--muted);font-size:16px;font-weight:400">Your signs will appear hereâ€¦</span>';
}

function addSpace() {
  sentence     += ' ';
  lastAddedChar = ' ';
  updateSentence();
}

function deleteLast() {
  sentence      = sentence.slice(0, -1);
  lastAddedChar = sentence.slice(-1) || '';
  updateSentence();
  holdStart = null;
}

function clearAll() {
  sentence = ''; lastAddedChar = '';
  updateSentence();
  holdStart = null;
  showToast('Cleared');
}

/* â”€â”€ Keyboard shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('keydown', e => {
  if (e.code === 'Space')      { e.preventDefault(); addSpace(); }
  if (e.code === 'Backspace')  { deleteLast(); }
  if (e.code === 'KeyC' && e.ctrlKey) { clearAll(); }
});

/* â”€â”€ Status pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setStatus(on) {
  statusPill.classList.toggle('inactive', !on);
  statusText.textContent = on ? 'Live' : 'Camera Off';
}

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let toastTimer = null;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

/* â”€â”€ Canvas roundRect polyfill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.arcTo(x + w, y, x + w, y + r, r);
  ctx.lineTo(x + w, y + h - r);
  ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
  ctx.lineTo(x + r, y + h);
  ctx.arcTo(x, y + h, x, y + h - r, r);
  ctx.lineTo(x, y + r);
  ctx.arcTo(x, y, x + r, y, r);
  ctx.closePath();
}

</script>
</body>
</html>
